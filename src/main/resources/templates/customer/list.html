<!DOCTYPE html>
<!-- saved from url=(0052)http://getbootstrap.com/docs/4.0/examples/dashboard/ -->
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>无验证码</title>
    <!-- Bootstrap core CSS -->
    <link href="../../static/asserts/css/bootstrap.min.css" th:href="@{/asserts/css/bootstrap.min.css}"
          rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../../static/asserts/css/dashboard.css" th:href="@{/asserts/css/dashboard.css}" rel="stylesheet">
    <style type="text/css">
        /* Chart.js */

        @-webkit-keyframes chartjs-render-animation {
            from {
                opacity: 0.99
            }
            to {
                opacity: 1
            }
        }

        @keyframes chartjs-render-animation {
            from {
                opacity: 0.99
            }
            to {
                opacity: 1
            }
        }
    </style>
</head>

<body>
<div class="container-fluid">
    <div class="row">
        <main role="main" class="col-md-9 ml-sm-auto col-lg-12 pt-3 px-4">
            <h2><a class="btn btn-sm btn-success" th:href="@{/verifyCustomers}" th:text="${type}=='Y'?'无验证码':'验证码'">跳转</a>
                <input class="btn btn-sm btn-primary" style="margin-left: 50px" type="button" value="重跑" th:onclick="retry()"/>
            </h2>
            <div class="table-responsive">
                <table id="sampleTableA" class="table table-striped table-sm">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>经销商代码</th>
                        <th>经销商名称</th>
                        <th>账号密码</th>
                        <th>网址</th>
                        <th>定时时间</th>
                        <th>加入任务</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="customer:${customers}">
                        <td th:text="${customerStat.index}+1"></td>
                        <td th:text="${customer.orgcode}"></td>
                        <td>[[${customer.orgname}]]</td>
                        <td th:text="${customer.params}"></td>
                        <td><a th:href="${customer.website}" target="_blank">[[${customer.website}]]</a></td>
                        <td th:text="${customer.dailyTime}"></td>
                        <td>
                            <a class="btn btn-sm btn-primary addBtn"
                               th:onclick="addCode([[${customer.orgcode}]])">加入</a>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <div style=" position: fixed; _position: absolute;top: 10px; right: 1px; _bottom: auto;
                    padding: 1px;
               z-index: 9999999; width:100px; height:30px;" class="p-t_10">
                    <input class="btn btn-sm btn-primary" type="button" value="执行任务" th:onclick="doCode()"/>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script type="text/javascript" src="../../static/asserts/js/jquery-3.2.1.slim.min.js"
        th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
<script type="text/javascript" src="../../static/asserts/js/popper.min.js"
        th:src="@{/asserts/js/popper.min.js}"></script>
<script type="text/javascript" src="../../static/asserts/js/bootstrap.min.js"
        th:src="@{/asserts/js/bootstrap.min.js}"></script>
<script src="../../static/asserts/js/fancyTable.js" th:src="@{/asserts/js/fancyTable.js}"></script>
<script type="text/javascript" th:inline="javascript">
    $(document).ready(function () {
        // And make them fancy
        $("#sampleTableA").fancyTable({
            sortColumn: 0,
            pagination: true,
            perPage: 2,
            globalSearch: true
        });
    });

    function addCode(orgCode) {
        $.ajax({
            url: "customers/add/" + orgCode,
            type: "POST",
            cache: false,
            async: false,
            success: function (result) {
                if (result['code']==200) {
                    alert("加入任务列表");
                } else {
                    alert(result['message']);
                }
            },
            error: function () {
                alert('服务器发生错误');
            }

        });
    }

    function doCode() {
        $.ajax({
            url: "customers/do",
            type: "POST",
            cache: false,
            async: false,
            success: function (result) {
                if (result['code']==200) {
                    alert(result['message']);
                }else if (result['code'] == 500) {
                    alert(result['message']);
                }else {
                    alert("正在执行其他任务")
                }
            },
            error: function () {
                alert('服务器发生错误');
            }

        });
    }

    function retry() {
        $.ajax({
            url: "customers/retry",
            type: "POST",
            cache: false,
            async: false,
            success: function (result) {
                if (result['code']==200) {
                    alert(result['message']);
                }else if (result['code'] == 500) {
                    alert(result['message']);
                }else {
                    alert("正在执行其他任务")
                }
            },
            error: function () {
                alert('服务器发生错误');
            }

        });
    }
</script>
</body>

</html>